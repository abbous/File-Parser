"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const shape_1 = require("./shape");
exports.convertCsvToArray = (rows, options) => {
    const { separator } = options;
    const rowElmentFactory = exports.createColumnsFactory(options);
    if (rows.length === 0)
        return [[]];
    const firstRow = rows.shift().split(separator).reduce(rowElmentFactory, []);
    const remainingRow = rows.reduce((stack, next) => {
        const rowDataArray = next.split(separator).reduce(rowElmentFactory, []);
        return exports.isIgnoreRowDataArray(firstRow, rowDataArray, options) ? stack : stack.concat([rowDataArray]);
    }, []);
    return [firstRow].concat(remainingRow);
};
exports.createColumnsFactory = (options) => {
    return (stack, elem, index) => {
        return shape_1.isNeededElement(options, index) ? stack.concat([shape_1.shapeData(elem, options)]) : stack;
    };
};
exports.isIgnoreRowDataArray = (keys, rowDataArray, options) => {
    const { defaultValue, ignoreRow } = options;
    const { emptyRow, lackElements } = ignoreRow;
    if (lackElements && rowDataArray.length < keys.length)
        return true;
    if (emptyRow && rowDataArray.every((elem) => elem === defaultValue))
        return true;
    return false;
};
